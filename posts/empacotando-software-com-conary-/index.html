<!DOCTYPE html>
<html lang="en">

<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Og Maciel's Personal Site.">
<meta name="author" content="Og Maciel">
<meta name="generator" content="Hugo">
<meta name="theme-color" content="#563d7c">

<title>Empacotando software com Conary</title>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">




<style>
  .bd-placeholder-img {
    font-size: 1.125rem;
    text-anchor: middle;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }

  @media (min-width: 768px) {
    .bd-placeholder-img-lg {
      font-size: 3.5rem;
    }
  }
</style>

<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">

<link href="/css/blog.css" rel="stylesheet"></head>

<body class="bg-light">
    <div class="container"><header class="blog-header py-3">
    <div class="row flex-nowrap justify-content-between align-items-center">
      <div class="col-4 pt-1">
        <a class="text-muted" href="/posts">Archives</a>
      </div>
      <div class="col-4 text-center">
        <a class="blog-header-logo text-dark" href="https://omaciel.github.io/">Home</a>
      </div>
      <div class="col-4 d-flex justify-content-end">
        <div class="col-4 pt-1">
            <a class="text-muted" href="/posts">Archives</a>
        </div>
      </div>
    </div>
</header>


<main role="main" class="container">
    <div class="row justify-content-md-center">
      <div class="col-md-9">
  
            <div class="blog-post">
            <h2 class="blog-post-title">Empacotando software com Conary</h2>
            <p class="blog-post-meta">Apr 26, 2007
                </p>

            
            <article><p>Muitas pessoas jÃ¡ tinham me pedido para escrever um pequeno tutorial
sobre como empacotar software para o <a href="http://www.foresightlinux.org/pt/">Foresight
Linux</a>. Para quem ainda nÃ£o conhece
o sistema de gerenciamento de pacotes
<a href="http://wiki.rpath.com/wiki/Conary">Conary</a>, uma forma de descrevÃª-lo
seria comparÃ¡-lo com um sistema de controle de versÃµes e gerenciamento
de pacotes. Isso quer dizer que vocÃª tem um controle sobre as
modificaÃ§Ãµes do cÃ³digo no mesmo estilo do CVS ou SVN, e qualquer
modificaÃ§Ã£o feita pelo mantenedor do cÃ³digo original Ã© implementado
em seu pacote em fragmentos, equivalentes Ã s linhas que foram
adicionadas ou modificadas.</p>
<p>Agora que estou lendo o parÃ¡grafo acima, notei que a explicaÃ§Ã£o nÃ£o
foi muito bem feita. Quem sabe um exemplo mais simples ajudaria a causa?</p>
<p>Imagine entÃ£o que vocÃª instalou seu programa preferido de ler fontes
de notÃ­cias RSS. Beleza! Vamos entÃ£o imaginar que amanhÃ£ o
desenvolvidor/mantenedor deste programa descobre um erro, e rapidamente
modifica <strong>uma linha</strong> de seu cÃ³digo para consertar este bug. Note a
Ãªnfase em <strong>uma linha</strong>. Eu, como desenvolvidor do Foresight empacoto
esta versÃ£o e a habilito em nossos repositÃ³rios para consumo geral.
Quando um usuÃ¡rio atualizar seu sistema, ele estarÃ¡ baixando o
equivalente Ã  aquela <strong>uma linha</strong> de cÃ³digo&hellip; e sÃ³! Em qualquer
outro sistema de empacotamento, vocÃª tem de baixar o cÃ³digo
(compilado) do programa inteiro para atualizar, mas o Conary te permite
atualizar somente a diferenÃ§a (diff)!</p>
<p>Bem, vamos entÃ£o imaginar que vocÃª estÃ¡ preparado para empacotar algo
usando o Conary. Existem alguns passos importantes que sÃ£o necessÃ¡rios
antes de vocÃª poder empacotar, mas vou deixar estes detalhes para um
prÃ³ximo artigo. Por agora, vou usar o meu prÃ³prio programa,
<a href="http://billreminder.sourceforge.net/">BillReminder</a>, como exemplo.</p>
<p>BillReminder Ã© um cÃ³digo escrito em python e pygtk, atualmente
hospedado no SourceForge.net. A versÃ£o atual disponibilizada para
download Ã© a versÃ£o 0.1.1. O motivo porque estou mencionando isso
ficarÃ¡ mais claro em alguns segundos.</p>
<p>Para empacotar qualquer coisa com o Conary, tudo que vocÃª precisa fazer
Ã© criar um arquivo com instruÃ§Ãµes sobre onde e como conseguir o
cÃ³digo fonte, entre outras coisas. Este arquivo, conhecido pelas
pessoas acostumados com o Conary como &ldquo;recipe&rdquo;, ou &ldquo;receita&rdquo; em
portuguÃªs, possui uma sintaxe bem &ldquo;pythÃ´nica&rdquo;, simples e clara. Segue
abaixo minha pequena receita:</p>
<blockquote>
<p>class BillReminder(PackageRecipe): name = &lsquo;billreminder&rsquo; version =
&lsquo;0.1.1&rsquo; buildRequires = [] def setup(r):
r.addArchive(&lsquo;mirror://sourceforge/%(name)s/') r.PythonSetup()</p>
</blockquote>
<p>Este modelo de receita Ã© bem bÃ¡sico, especial para empacotar programas
escritos em python. Note as informaÃ§Ãµes bÃ¡sicas, como nome, versÃ£o,
e localizaÃ§Ã£o do cÃ³digo fonte. Devido ao seu &ldquo;sabor&rdquo; de python,
podemos utilizar de expansÃ£o de variÃ¡veis para criar um URL dinÃ¢mico.
a linha</p>
<blockquote>
<p>r.addArchive(&lsquo;mirror://sourceforge/%(name)s/')</p>
</blockquote>
<p>entÃ£o Ã© &ldquo;traduzida&rdquo; para: baixe a fonte em algum mirror do
sourceforge.net, e procure pelo programa %(name)s, ou seja,
billreminder. O sistema conary consegue &ldquo;adivinhar&rdquo; de forma lÃ³gica
qual o pacote fonte para baixar, utilizando o nome e a versÃ£o para
distinguir de qualquer outro programa ou versÃ£o disponÃ­vel no mesmo
local. Se vocÃª fosse entÃ£o empacotar outro programa que tambÃ©m
estivesse hospedado no Sourceforge.net, bastaria vocÃª modificar a
variÃ¡vel &ldquo;name&rdquo; e &ldquo;version&rdquo;. Caso o cÃ³digo fonte estivesse em um outro
servidor (sem mirrors), vocÃª modificaria o URL.</p>
<blockquote>
<p>r.addArchive('<a href="http://%5Bservidor%5D/%25(name)s/">http://[servidor]/%(name)s/</a>')</p>
</blockquote>
<p>Depois de fazer e salvar nossa receita como billreminder.recipe (o final
do nome do arquivo tem de ser .recipe), Ã© hora de &ldquo;cozinharmos&rdquo;.
Geralmente, vocÃª &ldquo;cozinha&rdquo; sua receita 2 vezes. Na primeira vez, o
sistema conary irÃ¡ baixar o cÃ³digo fonte, compilÃ¡-lo, e completamente
(e automaticamente) nos informar sobre todas as dependÃªncias
necessÃ¡rias para empacotar o programa. Rodando o comando:</p>
<blockquote>
<p>cvc cook billreminder.recipe</p>
</blockquote>
<p>nos devolve, entre muitas linhas de saÃ­da, a seguinte lista de
dependÃªncias:</p>
<blockquote>
<p>'python-setuptools:python', 'dbus-python:python',
'desktop-file-utils:runtime', 'notify-python:python',
'pygobject:python', 'pygtk:python', 'python-sqlite:python'</p>
</blockquote>
<p>Ou seja, estes sÃ£o os nomes dos pacotes e componentes requeridos pelo
BillReminder. Editamos mais uma vez nossa &ldquo;receita&rdquo;, adicionando as
dependÃªncias na variÃ¡vel &ldquo;buildRequires&rdquo;.</p>
<blockquote>
<p>class BillReminder(PackageRecipe): name = &lsquo;billreminder&rsquo; version =
&lsquo;0.1.1&rsquo; buildRequires = [&lsquo;python-setuptools:python&rsquo;,
&lsquo;dbus-python:python&rsquo;, &lsquo;desktop-file-utils:runtime&rsquo;,
&lsquo;notify-python:python&rsquo;, &lsquo;pygobject:python&rsquo;, &lsquo;pygtk:python&rsquo;,
&lsquo;python-sqlite:python&rsquo;] def setup(r):
r.addArchive(&lsquo;mirror://sourceforge/%(name)s/') r.PythonSetup()</p>
</blockquote>
<p>e cozinhamos mais uma vez com o mesmo comando anterior. Depois de mais
alguns minutos, um arquivo contendo o programa compilado e todos os
arquivos por ele usado serÃ¡ gerado. O nome deste arquivo Ã© geralmente
formado pelo nome do programa, billreminder, e a versÃ£o, 0.1.1,
separados por um hÃ­fen, e terminando com um &ldquo;.css&rdquo;. Para instalar o
programa, basta agora usar o conary.</p>
<p>sudo conary update billreminder-0.1.1.css</p>
<p>e pronto! Como eu tinha mencionado antes, existem algumas coisas que eu
nÃ£o mencionei aqui, coisas que te ajudam a disponibilizar este pacote
em um repositÃ³rio para que outros possam consumÃ­-lo. Prometo que vou
detalhar estes detalhes em um prÃ³ximo artigo, mas sÃ³ para terminar o
processo, uma vez que seu pacote esteja em um repositÃ³rio, outras
pessoas poderÃ£o instalÃ¡-lo usando somente o nome do pacote (sem a
versÃ£o e o .css).</p>
<p>Uma outra coisa muito interessante do conary, Ã© o novo recurso de
&ldquo;cozinhar&rdquo; cÃ³digo diretamente de um repositÃ³rio SVN, CVS, ou
Mercurial. Este recurso foi lanÃ§ado ainda ontem (conary versÃ£o 1.1.23)
e eu jÃ¡ tenho planos de empacotar o BillReminder desta forma.</p>
<p>Bem, espero nÃ£o ter sido muito tÃ©cnico ou vago neste artigo. Ainda
estou aprendendo sobre o conary, e pretendo descrever em meu blog mais
detalhes desta fascinante tecnologia!</p>
</article>
  
          
          <div class="mb-4 p-5">
            <div class="card">
              <h5 class="card-header m-0">Tags</h5>
              <div class=" card-body">
                
                
                <a href="/tags/rpath" class="btn btn-dark btn-rounded mb-2">rpath</a>
                
                
              </div>
              </a>
            </div>

            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "journalofanopensourcee" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

          </div>
            </div>
        </div>
    </div>
</main>


    
    </div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
</body><footer class="blog-footer">
    <p>Theme built by <a href="https://twitter.com/OgMaciel">@OgMaciel</a>.</p>
    <p>
      <a href="#">Back to top</a>
    </p>
  </footer>
</html>